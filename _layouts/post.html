---
layout: default
---

<article class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>
    <p class="post-meta">
      {{ page.date | date: "%B %d, %Y" }}
      {% if page.author %}
        â€¢ {{ page.author }}
      {% endif %}
      {% if page.tags.size > 0 %}
        â€¢ Tags: 
        {% for tag in page.tags %}
          <a href="{{ site.baseurl }}/tags/#{{ tag | slugify }}">{{ tag }}</a>{% if forloop.last == false %}, {% endif %}
        {% endfor %}
      {% endif %}
    </p>
  </header>

  <div class="post-content">
    {{ content }}
  </div>

  <!-- å‚è€ƒæ–‡ç« åŒºåŸŸ -->
  {% if page.references and page.references.size > 0 %}
    <div class="post-references">
      <h2>å‚è€ƒæ–‡ç« </h2>
      <ol class="references-list">
        {% for ref in page.references %}
          <li class="reference-item">
            {% if ref.url %}
              <a href="{{ ref.url }}" target="_blank" rel="noopener noreferrer" class="reference-link">
                {{ ref.title }}
              </a>
            {% else %}
              <span class="reference-title">{{ ref.title }}</span>
            {% endif %}
            {% if ref.author %}
              <span class="reference-author"> - {{ ref.author }}</span>
            {% endif %}
            {% if ref.date %}
              <span class="reference-date"> ({{ ref.date }})</span>
            {% endif %}
            {% if ref.publisher %}
              <span class="reference-publisher"> - {{ ref.publisher }}</span>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </div>
  {% endif %}

  <div class="post-navigation">
    {% if page.previous.url %}
      <a href="{{ page.previous.url }}" class="prev-post">
        <span class="nav-label">ä¸Šä¸€ç¯‡</span>
        <h3 class="nav-title">{{ page.previous.title }}</h3>
      </a>
    {% endif %}
    {% if page.next.url %}
      <a href="{{ page.next.url }}" class="next-post">
        <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
        <h3 class="nav-title">{{ page.next.title }}</h3>
      </a>
    {% endif %}
  </div>
  
  <div class="post-stats">
    <!-- è®¿é—®é‡ç»Ÿè®¡ -->
    <div class="post-views">
      <span class="stats-label">é˜…è¯»é‡ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </div>
    
    <!-- ç‚¹èµåŠŸèƒ½ -->
    <div class="post-like">
      <button id="like-btn" class="like-button" onclick="toggleLike()">
        <span id="like-icon">â¤ï¸</span>
        <span id="like-count">0</span>
      </button>
    </div>
    
    <!-- æ”¶è—åŠŸèƒ½ -->
    <div class="post-bookmark">
      <button id="bookmark-btn" class="bookmark-button" onclick="bookmarkPage()">
        <span id="bookmark-icon">â­</span>
        <span id="bookmark-text">æ”¶è—</span>
      </button>
    </div>
    
    <!-- åˆ†äº«åŠŸèƒ½ -->
    <div class="post-share">
      <button id="share-btn" class="share-button" onclick="toggleShareMenu()">
        <span id="share-icon">ğŸ“¤</span>
        <span id="share-text">åˆ†äº«</span>
      </button>
      <div id="share-menu" class="share-menu">
        <button class="share-item" onclick="copyLink()">
          <span class="share-item-icon">ğŸ”—</span>
          <span class="share-item-text">å¤åˆ¶é“¾æ¥</span>
        </button>
        <a href="https://service.wechat.com/share/" target="_blank" class="share-item wechat-share" title="åˆ†äº«åˆ°å¾®ä¿¡">
          <span class="share-item-icon">ğŸ’¬</span>
          <span class="share-item-text">å¾®ä¿¡</span>
        </a>
        <a href="https://connect.qq.com/widget/shareqq/index.html?url={{ site.url }}{{ page.url }}&title={{ page.title }}&desc={{ page.excerpt | strip_html | truncate: 100 }}&summary={{ page.excerpt | strip_html | truncate: 100 }}&pics=&style=203&width=32&height=32" target="_blank" class="share-item qq-share" title="åˆ†äº«åˆ°QQ">
          <span class="share-item-icon">ğŸ§</span>
          <span class="share-item-text">QQ</span>
        </a>
        <button class="share-item" onclick="generateQrCode()">
          <span class="share-item-icon">ğŸ“±</span>
          <span class="share-item-text">äºŒç»´ç </span>
        </button>
      </div>
    </div>
  </div>
  
  <script>
    // åˆå§‹åŒ–ç‚¹èµåŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function() {
      const postId = '{{ page.url }}';
      const hasLikedKey = 'has_liked_' + postId;
      
      // æ¢å¤ç”¨æˆ·ç‚¹èµçŠ¶æ€
      const hasLiked = localStorage.getItem(hasLikedKey) === 'true';
      if (hasLiked) {
        document.getElementById('like-icon').textContent = 'ğŸ’–';
        document.getElementById('like-text').textContent = 'å·²ç‚¹èµ';
      }
      
      // åŠ è½½æ€»ç‚¹èµæ•°
      loadTotalLikes();
    });
    
    // åŠ è½½æ€»ç‚¹èµæ•°ï¼ˆä½¿ç”¨GitHub Issues APIå®ç°è·¨ç”¨æˆ·ç»Ÿè®¡ï¼‰
    function loadTotalLikes() {
      const repo = '{{ site.repository }}';
      const postTitle = '{{ page.title }}';
      const issueTitle = `ç‚¹èµç»Ÿè®¡: ${postTitle}`;
      
      // ä½¿ç”¨GitHub Issues APIæŸ¥æ‰¾æˆ–åˆ›å»ºç‚¹èµè®°å½•
      fetch(`https://api.github.com/repos/${repo}/issues?labels=like-stat&per_page=100`)
        .then(response => response.json())
        .then(issues => {
          // æŸ¥æ‰¾åŒ¹é…å½“å‰æ–‡ç« çš„ç‚¹èµissue
          let likeIssue = issues.find(issue => issue.title === issueTitle);
          
          if (likeIssue) {
            // å¦‚æœæ‰¾åˆ°ï¼Œæ˜¾ç¤ºç‚¹èµæ•°ï¼ˆä½¿ç”¨issueçš„commentsæ•°é‡ä½œä¸ºç‚¹èµæ•°ï¼‰
            document.getElementById('like-count').textContent = likeIssue.comments;
          } else {
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œæ˜¾ç¤ºåˆå§‹ç‚¹èµæ•°0
            document.getElementById('like-count').textContent = '0';
          }
        })
        .catch(err => {
          console.error('è·å–ç‚¹èµæ•°å¤±è´¥ï¼Œä½¿ç”¨localStorageå›é€€æ–¹æ¡ˆ:', err);
          // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨localStorageå›é€€æ–¹æ¡ˆ
          const postId = '{{ page.url }}';
          const likeCountKey = 'like_count_' + postId;
          const likeCount = localStorage.getItem(likeCountKey) || '0';
          document.getElementById('like-count').textContent = likeCount;
        });
    }
    
    // åˆ‡æ¢ç‚¹èµçŠ¶æ€
    function toggleLike() {
      const postId = '{{ page.url }}';
      const hasLikedKey = 'has_liked_' + postId;
      const repo = '{{ site.repository }}';
      const postTitle = '{{ page.title }}';
      const issueTitle = `ç‚¹èµç»Ÿè®¡: ${postTitle}`;
      
      // è·å–å½“å‰ç‚¹èµçŠ¶æ€
      const hasLiked = localStorage.getItem(hasLikedKey) === 'true';
      
      if (hasLiked) {
        // å–æ¶ˆç‚¹èµ
        localStorage.setItem(hasLikedKey, 'false');
        document.getElementById('like-icon').textContent = 'â¤ï¸';
        document.getElementById('like-text').textContent = 'ç‚¹èµ';
        
        // æ·»åŠ å–æ¶ˆç‚¹èµåŠ¨ç”»
        const btn = document.getElementById('like-btn');
        btn.style.transform = 'scale(0.9)';
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
        }, 100);
      } else {
        // ç‚¹èµ
        localStorage.setItem(hasLikedKey, 'true');
        document.getElementById('like-icon').textContent = 'ğŸ’–';
        document.getElementById('like-text').textContent = 'å·²ç‚¹èµ';
        
        // æ·»åŠ ç‚¹èµåŠ¨ç”»
        const btn = document.getElementById('like-btn');
        btn.style.transform = 'scale(1.2)';
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
        }, 200);
        
        // æ˜¾ç¤ºç‚¹èµæˆåŠŸæç¤º
        showTempMessage('ç‚¹èµæˆåŠŸï¼');
        
        // å‘é€ç‚¹èµè¯·æ±‚åˆ°GitHub Issues API
        fetch(`https://api.github.com/repos/${repo}/issues?labels=like-stat&per_page=100`)
          .then(response => response.json())
          .then(issues => {
            // æŸ¥æ‰¾åŒ¹é…å½“å‰æ–‡ç« çš„ç‚¹èµissue
            let likeIssue = issues.find(issue => issue.title === issueTitle);
            
            if (likeIssue) {
              // å¦‚æœæ‰¾åˆ°ï¼Œæ·»åŠ ç‚¹èµè¯„è®º
              return fetch(`https://api.github.com/repos/${repo}/issues/${likeIssue.number}/comments`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  body: 'ğŸ‘ ç‚¹èµäº ' + new Date().toISOString()
                })
              });
            } else {
              // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ›å»ºæ–°çš„ç‚¹èµissue
              return fetch(`https://api.github.com/repos/${repo}/issues`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  title: issueTitle,
                  body: 'æ–‡ç« ç‚¹èµç»Ÿè®¡è®°å½•',
                  labels: ['like-stat']
                })
              });
            }
          })
          .then(response => {
            if (response.ok) {
              // ç‚¹èµæˆåŠŸåé‡æ–°åŠ è½½ç‚¹èµæ•°
              loadTotalLikes();
            }
          })
          .catch(err => {
            console.error('å‘é€ç‚¹èµå¤±è´¥ï¼Œä½¿ç”¨localStorageå›é€€æ–¹æ¡ˆ:', err);
            // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨localStorageå›é€€æ–¹æ¡ˆ
            const likeCountKey = 'like_count_' + postId;
            let likeCount = parseInt(localStorage.getItem(likeCountKey) || '0');
            likeCount++;
            localStorage.setItem(likeCountKey, likeCount.toString());
            document.getElementById('like-count').textContent = likeCount;
          });
      }
    }
    
    function bookmarkPage() {
      const bookmarkBtn = document.getElementById('bookmark-btn');
      const bookmarkIcon = document.getElementById('bookmark-icon');
      const bookmarkText = document.getElementById('bookmark-text');
      
      try {
        // å°è¯•ä½¿ç”¨ç°ä»£æµè§ˆå™¨API
        if (navigator.clipboard) {
          // æ£€æŸ¥æ˜¯å¦æ”¯æŒä¹¦ç­¾API
          if (window.sidebar && window.sidebar.addPanel) {
            // Firefox
            window.sidebar.addPanel(document.title, window.location.href, '');
          } else if (window.external && ('AddFavorite' in window.external)) {
            // IE
            window.external.AddFavorite(window.location.href, document.title);
          } else if (navigator.userAgent.includes('Chrome') || navigator.userAgent.includes('Safari')) {
            // Chrome/Safari
            alert('è¯·æŒ‰ Ctrl+D (Windows) æˆ– Cmd+D (Mac) æ·»åŠ åˆ°æ”¶è—å¤¹');
          }
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          bookmarkIcon.textContent = 'ğŸŒŸ';
          bookmarkText.textContent = 'å·²æ”¶è—';
          bookmarkBtn.disabled = true;
          
          // æ·»åŠ ä¸´æ—¶æç¤º
          const tempMsg = document.createElement('div');
          tempMsg.textContent = 'æ–‡ç« å·²æ·»åŠ åˆ°æ”¶è—å¤¹ï¼';
          tempMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000;';
          document.body.appendChild(tempMsg);
          setTimeout(() => {
            tempMsg.remove();
          }, 3000);
        }
      } catch (error) {
        console.error('æ”¶è—å¤±è´¥:', error);
        alert('æ”¶è—åŠŸèƒ½æš‚ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ åˆ°æ”¶è—å¤¹');
      }
    }
    
    // åˆ†äº«åŠŸèƒ½
    let shareMenuVisible = false;
    
    function toggleShareMenu() {
      const shareMenu = document.getElementById('share-menu');
      shareMenuVisible = !shareMenuVisible;
      shareMenu.style.display = shareMenuVisible ? 'block' : 'none';
    }
    
    // å¤åˆ¶é“¾æ¥
    function copyLink() {
      const url = window.location.href;
      navigator.clipboard.writeText(url).then(() => {
        showTempMessage('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        toggleShareMenu();
      }).catch(err => {
        console.error('å¤åˆ¶é“¾æ¥å¤±è´¥:', err);
        alert('å¤åˆ¶é“¾æ¥å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
      });
    }
    
    // ç”ŸæˆäºŒç»´ç 
    function generateQrCode() {
      const url = window.location.href;
      const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
      
      // åˆ›å»ºäºŒç»´ç å¼¹çª—
      const qrModal = document.createElement('div');
      qrModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      `;
      
      const qrContent = document.createElement('div');
      qrContent.style.cssText = `
        background: white;
        padding: 2rem;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      `;
      
      const qrImage = document.createElement('img');
      qrImage.src = qrCodeUrl;
      qrImage.alt = 'æ–‡ç« äºŒç»´ç ';
      qrImage.style.marginBottom = '1rem';
      
      const qrTitle = document.createElement('h3');
      qrTitle.textContent = 'æ‰«ç é˜…è¯»æ–‡ç« ';
      qrTitle.style.marginBottom = '0.5rem';
      
      const qrDesc = document.createElement('p');
      qrDesc.textContent = 'ä½¿ç”¨å¾®ä¿¡æˆ–QQæ‰«ç ';
      qrDesc.style.color = '#666';
      qrDesc.style.marginBottom = '1.5rem';
      
      const closeBtn = document.createElement('button');
      closeBtn.textContent = 'å…³é—­';
      closeBtn.style.cssText = `
        background: #007bff;
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
      `;
      closeBtn.onclick = () => {
        document.body.removeChild(qrModal);
      };
      
      qrContent.appendChild(qrImage);
      qrContent.appendChild(qrTitle);
      qrContent.appendChild(qrDesc);
      qrContent.appendChild(closeBtn);
      qrModal.appendChild(qrContent);
      
      document.body.appendChild(qrModal);
      toggleShareMenu();
    }
    
    // æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯
    function showTempMessage(text) {
      const tempMsg = document.createElement('div');
      tempMsg.textContent = text;
      tempMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px; z-index: 10000;';
      document.body.appendChild(tempMsg);
      setTimeout(() => {
        tempMsg.remove();
      }, 3000);
    }
    
    // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­åˆ†äº«èœå•
    document.addEventListener('click', function(e) {
      const shareBtn = document.getElementById('share-btn');
      const shareMenu = document.getElementById('share-menu');
      if (shareMenuVisible && !shareBtn.contains(e.target) && !shareMenu.contains(e.target)) {
        toggleShareMenu();
      }
    });
  </script>
</article>