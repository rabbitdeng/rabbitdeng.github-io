<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base href="{{ site.url }}/{{ site.baseurl }}/" />
  <title>{% if page.title %}{{ page.title }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  
  <!-- CSS -->
  <link rel="stylesheet" href="{{ "/css/main.css" | relative_url }}">
  
  <!-- SEO -->
  {% seo %}
</head>
<body>
  <!-- Header -->
  {% include header.html %}
  
  <!-- Main Content -->
  <main class="container">
    {{ content }}
  </main>
  
  <!-- Footer -->
  {% include footer.html %}
  
  <!-- 不蒜子访问统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <!-- 代码复制功能 -->
  <script>
    // 为所有代码块添加复制按钮
    document.addEventListener('DOMContentLoaded', function() {
      const preBlocks = document.querySelectorAll('pre');
      
      preBlocks.forEach(pre => {
        // 创建复制按钮
        const copyBtn = document.createElement('button');
        copyBtn.className = 'code-copy-btn';
        copyBtn.textContent = '复制';
        
        // 添加复制功能
        copyBtn.addEventListener('click', function() {
          const code = pre.querySelector('code');
          if (code) {
            // 获取代码内容
            const codeText = code.textContent;
            
            // 使用Clipboard API复制代码
            navigator.clipboard.writeText(codeText).then(() => {
              // 显示复制成功状态
              copyBtn.textContent = '已复制';
              copyBtn.classList.add('copied');
              
              // 2秒后恢复原状
              setTimeout(() => {
                copyBtn.textContent = '复制';
                copyBtn.classList.remove('copied');
              }, 2000);
            }).catch(err => {
              console.error('复制失败:', err);
              copyBtn.textContent = '复制失败';
              
              setTimeout(() => {
                copyBtn.textContent = '复制';
              }, 2000);
            });
          }
        });
        
        // 将按钮添加到代码块中
        pre.appendChild(copyBtn);
      });
      
      // 获取GitHub Stars数量
      const githubStarsElement = document.getElementById('github-stars');
      if (githubStarsElement) {
        fetch('https://api.github.com/users/rabbitdeng/repos?per_page=100')
          .then(response => response.json())
          .then(repos => {
            const totalStars = repos.reduce((sum, repo) => sum + repo.stargazers_count, 0);
            githubStarsElement.textContent = totalStars;
          })
          .catch(err => {
            console.error('获取GitHub Stars失败:', err);
            githubStarsElement.textContent = '获取失败';
          });
      }
    });
  </script>
</body>
</html>